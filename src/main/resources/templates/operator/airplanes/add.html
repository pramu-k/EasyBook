<!-- src/main/resources/templates/operator/airplanes/add.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <meta charset="UTF-8">
  <title>Add New Airplane</title>
</head>
<body>
<div layout:fragment="content">
  <div class="container mt-4">
    <h2>Add New Airplane</h2>
    <hr>

    <form th:action="@{/operator/airplanes}" method="post" th:object="${airplane}">
      <!-- Basic Airplane Info -->
      <div class="card mb-4">
        <div class="card-header">Airplane Details</div>
        <div class="card-body">
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label">Registration Number</label>
              <input type="text" class="form-control" th:field="*{registrationNumber}" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Manufacturer</label>
              <input type="text" class="form-control" th:field="*{manufacturer}" required>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label">Model</label>
              <input type="text" class="form-control" th:field="*{model}" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Total Seat Capacity</label>
              <input type="number" class="form-control" th:field="*{seatCapacity}"
                     min="1" max="1000" required id="seatCapacityInput">
            </div>
          </div>
        </div>
      </div>

      <!-- Seat Configuration -->
      <div class="card mb-4">
        <div class="card-header">Seat Configuration</div>
        <div class="card-body">
          <div class="row mb-3">
            <div class="col-md-4">
              <label class="form-label">Business Class Rows</label>
              <input type="number" class="form-control" min="0" value="5" id="businessRows">
            </div>
            <div class="col-md-4">
              <label class="form-label">Economy Class Rows</label>
              <input type="number" class="form-control" min="1" value="20" id="economyRows">
            </div>
            <div class="col-md-4">
              <label class="form-label">Seats Per Row</label>
              <input type="number" class="form-control" min="4" max="10" value="6" id="seatsPerRow">
            </div>
          </div>
          <div class="mb-3">
            <button type="button" class="btn btn-secondary" id="previewSeats">
              Preview Seat Layout
            </button>
          </div>

          <!-- Seat Layout Preview -->
          <div id="seatLayoutPreview" class="d-none">
            <h5>Seat Layout Preview</h5>
            <div class="seat-map-container mb-3" style="overflow-x: auto;">
              <div id="seatMap" class="seat-map"></div>
            </div>
            <div class="seat-legend">
              <span class="badge bg-success me-2">Business Class</span>
              <span class="badge bg-primary me-2">Economy Class</span>
            </div>
          </div>
        </div>
      </div>

      <input type="hidden" id="seatConfiguration" name="seatConfiguration">

      <div class="d-flex justify-content-between">
        <a th:href="@{/operator/airplanes}" class="btn btn-secondary">Cancel</a>
        <button type="submit" class="btn btn-primary">Save Airplane</button>
      </div>
    </form>
  </div>
</div>


<script>
  document.getElementById('previewSeats').addEventListener('click', function() {
    const businessRows = parseInt(document.getElementById('businessRows').value);
    const economyRows = parseInt(document.getElementById('economyRows').value);
    const seatsPerRow = parseInt(document.getElementById('seatsPerRow').value);
    const totalSeats = businessRows * seatsPerRow + economyRows * seatsPerRow;

    // Validate against total capacity
    const seatCapacity = parseInt(document.getElementById('seatCapacityInput').value);
    if (totalSeats > seatCapacity) {
      alert(`You've configured ${totalSeats} seats but the airplane capacity is only ${seatCapacity}`);
      return;
    }

    // Generate seat map preview
    const seatMap = document.getElementById('seatMap');
    seatMap.innerHTML = '';

    // Generate business class seats
    for (let row = 1; row <= businessRows; row++) {
      const rowDiv = document.createElement('div');
      rowDiv.className = 'seat-row mb-2';
      for (let seatNum = 1; seatNum <= seatsPerRow; seatNum++) {
        const seatLetter = String.fromCharCode(64 + seatNum);
        const seat = document.createElement('span');
        seat.className = 'seat business-class me-2 p-2 d-inline-block';
        seat.textContent = `${row}${seatLetter}`;
        rowDiv.appendChild(seat);
      }
      seatMap.appendChild(rowDiv);
    }

    // Generate economy class seats
    for (let row = businessRows + 1; row <= businessRows + economyRows; row++) {
      const rowDiv = document.createElement('div');
      rowDiv.className = 'seat-row mb-2';
      for (let seatNum = 1; seatNum <= seatsPerRow; seatNum++) {
        const seatLetter = String.fromCharCode(64 + seatNum);
        const seat = document.createElement('span');
        seat.className = 'seat economy-class me-2 p-2 d-inline-block';
        seat.textContent = `${row}${seatLetter}`;
        rowDiv.appendChild(seat);
      }
      seatMap.appendChild(rowDiv);
    }

    // Prepare seat configuration data
    const seatConfiguration = {
      businessRows,
      economyRows,
      seatsPerRow,
      totalSeats
    };
    document.getElementById('seatConfiguration').value = JSON.stringify(seatConfiguration);

    // Show preview
    document.getElementById('seatLayoutPreview').classList.remove('d-none');
  });
</script>
<style>
  .seat {
    width: 40px;
    text-align: center;
    border-radius: 4px;
    cursor: pointer;
  }
  .business-class {
    background-color: #198754;
    color: white;
  }
  .economy-class {
    background-color: #0d6efd;
    color: white;
  }
  .seat-map {
    font-family: monospace;
    white-space: nowrap;
  }
</style>
</body>
</html>